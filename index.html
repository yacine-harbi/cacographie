<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cacography - Apprendre l'orthographe fran√ßaise</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'duolingo': {
                            green: '#58CC02',
                            'green-dark': '#46A302',
                            blue: '#1CB0F6',
                            'blue-dark': '#1899D6',
                            red: '#FF4B4B',
                            orange: '#FF9600',
                            purple: '#CE82FF',
                            yellow: '#FFC800',
                            gray: {
                                100: '#F7F7F7',
                                200: '#E5E5E5',
                                300: '#ADADAD',
                                600: '#777777',
                                800: '#4B4B4B'
                            }
                        }
                    },
                    fontFamily: {
                        'nunito': ['Nunito', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <!-- Custom CSS -->
    <style>
        body {
            font-family: 'Nunito', sans-serif;
        }
        
        .word-clickable {
            transition: all 0.3s ease;
            cursor: pointer;
            padding: 4px 6px;
            border-radius: 6px;
            margin: 0 2px;
            display: inline-block;
        }
        
        .word-clickable:hover {
            background-color: #e0f2fe;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .word-correct {
            background-color: #dcfce7;
            color: #166534;
            animation: bounce 0.6s ease;
        }
        
        .word-incorrect {
            background-color: #fecaca;
            color: #991b1b;
            animation: shake 0.5s ease;
        }
        
        .lesson-card {
            transition: all 0.3s ease;
        }
        
        .lesson-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .hearts {
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
        }
        
        .progress-bar {
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .pulse-animation {
            animation: pulse 1s ease-in-out infinite;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-duolingo-gray-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Your French lesson data from the JSON you provided, adapted for the game
        const lessonData = {
            easy: [
                {
                    id: 1,
                    title: "Accents manquants",
                    description: "Trouvez les mots sans leurs accents",
                    difficulty: "Facile",
                    xp: 15,
                    sentences: [
                        {
                            text: "Je suis un eleve.",
                            words: ["Je", "suis", "un", "eleve."],
                            errorIndex: 3,
                            correction: "√©l√®ve",
                            explanation: "Il manque l'accent grave sur la voyelle.",
                            translation: "I am a student."
                        },
                        {
                            text: "Nous avons ete surpris.",
                            words: ["Nous", "avons", "ete", "surpris."],
                            errorIndex: 2,
                            correction: "√©t√©",
                            explanation: "Le participe pass√© '√©t√©' prend un accent circonflexe.",
                            translation: "We were surprised."
                        },
                        {
                            text: "Un gateau au chocolat.",
                            words: ["Un", "gateau", "au", "chocolat."],
                            errorIndex: 1,
                            correction: "g√¢teau",
                            explanation: "Le mot 'g√¢teau' prend un accent circonflexe.",
                            translation: "A chocolate cake."
                        }
                    ]
                },
                {
                    id: 2,
                    title: "Accords au pluriel",
                    description: "Les mots qui oublient leur 's'",
                    difficulty: "Facile", 
                    xp: 15,
                    sentences: [
                        {
                            text: "Les chien courent vite.",
                            words: ["Les", "chien", "courent", "vite."],
                            errorIndex: 1,
                            correction: "chiens",
                            explanation: "Le nom doit √™tre au pluriel.",
                            translation: "The dogs run fast."
                        },
                        {
                            text: "Ces enfant jouent.",
                            words: ["Ces", "enfant", "jouent."],
                            errorIndex: 1,
                            correction: "enfants",
                            explanation: "Le nom doit √™tre au pluriel.",
                            translation: "These children are playing."
                        }
                    ]
                }
            ],
            medium: [
                {
                    id: 3,
                    title: "Homophones √†/a",
                    description: "Distinguer '√†' et 'a'",
                    difficulty: "Moyen",
                    xp: 25,
                    sentences: [
                        {
                            text: "Il c'est lev√© tard.",
                            words: ["Il", "c'est", "lev√©", "tard."],
                            errorIndex: 1,
                            correction: "s'est",
                            explanation: "On √©crit 'Il s'est lev√©'.",
                            translation: "He got up late."
                        },
                        {
                            text: "Elle √† beaucoup travaill√©.",
                            words: ["Elle", "√†", "beaucoup", "travaill√©."],
                            errorIndex: 1,
                            correction: "a",
                            explanation: "On √©crit 'elle a' sans accent.",
                            translation: "She worked a lot."
                        }
                    ]
                }
            ],
            hard: [
                {
                    id: 4,
                    title: "Conjugaisons complexes",
                    description: "Subjonctif et participes",
                    difficulty: "Difficile",
                    xp: 35,
                    sentences: [
                        {
                            text: "Il faut que tu vien.",
                            words: ["Il", "faut", "que", "tu", "vien."],
                            errorIndex: 4,
                            correction: "viennes",
                            explanation: "Subjonctif: 'que tu viennes'.",
                            translation: "You need to come."
                        }
                    ]
                }
            ]
        };

        // Custom hook for localStorage
        const useLocalStorage = (key, initialValue) => {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    console.error('LocalStorage error:', error);
                    return initialValue;
                }
            });

            const setValue = (value) => {
                try {
                    setStoredValue(value);
                    window.localStorage.setItem(key, JSON.stringify(value));
                } catch (error) {
                    console.error('LocalStorage error:', error);
                }
            };

            return [storedValue, setValue];
        };

        // Header Component
        const Header = ({ xp, hearts, streak }) => (
            <header className="bg-white shadow-md border-b-4 border-duolingo-green">
                <div className="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
                    <div className="flex items-center space-x-6">
                        <h1 className="text-3xl font-bold text-duolingo-green">Cacography</h1>
                        <div className="hidden md:flex items-center space-x-2">
                            <span className="text-duolingo-orange text-2xl">üî•</span>
                            <span className="font-bold text-duolingo-orange text-xl">{streak}</span>
                        </div>
                    </div>
                    
                    <div className="flex items-center space-x-6">
                        <div className="flex items-center space-x-2">
                            <span className="text-duolingo-blue text-2xl">üíé</span>
                            <span className="font-bold text-duolingo-blue text-xl">{xp} XP</span>
                        </div>
                        <div className="flex items-center space-x-1 hearts">
                            {[...Array(5)].map((_, i) => (
                                <span key={i} className={`text-2xl ${i < hearts ? 'text-red-500' : 'text-duolingo-gray-300'}`}>‚ù§Ô∏è</span>
                            ))}
                        </div>
                    </div>
                </div>
            </header>
        );

        // Progress Bar Component
        const ProgressBar = ({ current, total, className = "" }) => {
            const percentage = Math.min((current / total) * 100, 100);
            
            return (
                <div className={`w-full bg-duolingo-gray-200 rounded-full h-6 ${className}`}>
                    <div 
                        className="bg-duolingo-green h-6 rounded-full progress-bar flex items-center justify-end pr-2"
                        style={{ width: `${percentage}%` }}
                    >
                        {percentage > 20 && (
                            <span className="text-white text-xs font-bold">
                                {Math.round(percentage)}%
                            </span>
                        )}
                    </div>
                </div>
            );
        };

        // Lesson Card Component
        const LessonCard = ({ lesson, onStart, isLocked, isCompleted }) => (
            <div className={`lesson-card bg-white rounded-xl p-6 shadow-lg border-b-4 ${
                isLocked 
                    ? 'border-duolingo-gray-300 opacity-60' 
                    : isCompleted
                        ? 'border-duolingo-yellow'
                        : lesson.difficulty === 'Facile' 
                            ? 'border-duolingo-green' 
                            : lesson.difficulty === 'Moyen' 
                                ? 'border-duolingo-blue' 
                                : 'border-duolingo-purple'
            }`}>
                <div className="flex items-center justify-between mb-4">
                    <div className={`px-4 py-2 rounded-full text-sm font-bold ${
                        lesson.difficulty === 'Facile' 
                            ? 'bg-duolingo-green text-white' 
                            : lesson.difficulty === 'Moyen' 
                                ? 'bg-duolingo-blue text-white' 
                                : 'bg-duolingo-purple text-white'
                    }`}> 
                        {lesson.difficulty}
                    </div>
                    <div className="flex items-center space-x-2">
                        {isCompleted && <span className="text-duolingo-yellow text-xl">‚≠ê</span>}
                        <span className="text-duolingo-blue text-lg">üíé</span>
                        <span className="font-bold text-duolingo-gray-600">{lesson.xp} XP</span>
                    </div>
                </div>
                
                <h3 className="text-xl font-bold text-duolingo-gray-800 mb-2">{lesson.title}</h3>
                <p className="text-duolingo-gray-600 mb-6">{lesson.description}</p>
                
                <button
                    className={`w-full py-4 px-6 rounded-xl font-bold text-white transition-all duration-200 ${
                        isLocked 
                            ? 'bg-duolingo-gray-300 cursor-not-allowed' 
                            : 'bg-duolingo-green hover:bg-duolingo-green-dark hover:shadow-lg transform hover:scale-105'
                    }`}
                    onClick={() => !isLocked && onStart(lesson)}
                    disabled={isLocked}
                >
                    {isLocked ? 'üîí Bloqu√©' : isCompleted ? '‚úÖ Recommencer' : 'üöÄ Commencer'}
                </button>
            </div>
        );

        // Game Screen Component
        const GameScreen = ({ lesson, onComplete, onBack }) => {
            const [currentSentenceIndex, setCurrentSentenceIndex] = useState(0);
            const [selectedWord, setSelectedWord] = useState(null);
            const [showFeedback, setShowFeedback] = useState(false);
            const [hearts, setHearts] = useState(5);
            const [score, setScore] = useState(0);
            const [gameComplete, setGameComplete] = useState(false);

            const currentSentence = lesson.sentences[currentSentenceIndex];

            const handleWordClick = (wordIndex) => {
                if (showFeedback || gameComplete) return;

                const isCorrect = wordIndex === currentSentence.errorIndex;
                setSelectedWord({ index: wordIndex, correct: isCorrect });
                setShowFeedback(true);

                if (isCorrect) {
                    setScore(score + 1);
                } else {
                    setHearts(hearts - 1);
                }

                setTimeout(() => {
                    if (currentSentenceIndex < lesson.sentences.length - 1) {
                        setCurrentSentenceIndex(currentSentenceIndex + 1);
                        setSelectedWord(null);
                        setShowFeedback(false);
                    } else {
                        setGameComplete(true);
                        setTimeout(() => {
                            onComplete(score + (isCorrect ? 1 : 0), hearts - (isCorrect ? 0 : 1));
                        }, 2000);
                    }
                }, 2000);
            };

            const handleNoMistake = () => {
                if (showFeedback || gameComplete) return;
                
                // Check if there actually is no mistake (errorIndex would be -1 or null for no mistake)
                const isCorrect = currentSentence.errorIndex === null || currentSentence.errorIndex === -1;
                setShowFeedback(true);
                
                if (isCorrect) {
                    setScore(score + 1);
                } else {
                    setHearts(hearts - 1);
                }

                setTimeout(() => {
                    if (currentSentenceIndex < lesson.sentences.length - 1) {
                        setCurrentSentenceIndex(currentSentenceIndex + 1);
                        setSelectedWord(null);
                        setShowFeedback(false);
                    } else {
                        setGameComplete(true);
                        setTimeout(() => {
                            onComplete(score + (isCorrect ? 1 : 0), hearts - (isCorrect ? 0 : 1));
                        }, 2000);
                    }
                }, 2000);
            };

            const getWordClassName = (wordIndex) => {
                if (!selectedWord) return 'word-clickable';
                
                if (selectedWord.index === wordIndex) {
                    return selectedWord.correct ? 'word-correct' : 'word-incorrect';
                }
                
                if (showFeedback && wordIndex === currentSentence.errorIndex) {
                    return 'word-correct';
                }
                
                return 'word-clickable opacity-50';
            };

            if (gameComplete) {
                return (
                    <div className="max-w-4xl mx-auto px-4 py-8">
                        <div className="bg-white rounded-xl shadow-2xl p-8 text-center fade-in">
                            <div className="text-6xl mb-4">üéâ</div>
                            <h2 className="text-3xl font-bold text-duolingo-green mb-4">
                                Le√ßon termin√©e !
                            </h2>
                            <div className="text-xl text-duolingo-gray-600 mb-6">
                                Score: {score}/{lesson.sentences.length}
                            </div>
                            <button
                                onClick={onBack}
                                className="bg-duolingo-green text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-duolingo-green-dark transition-all duration-200"
                            >
                                Retour au menu
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-4xl mx-auto px-4 py-8 fade-in">
                    <div className="bg-white rounded-xl shadow-2xl p-8">
                        <div className="flex items-center justify-between mb-6">
                            <button 
                                onClick={onBack}
                                className="text-duolingo-gray-600 hover:text-duolingo-gray-800 text-3xl font-bold transition-colors"
                            >
                                ‚Üê Retour
                            </button>
                            <div className="flex items-center space-x-1 hearts">
                                {[...Array(5)].map((_, i) => (
                                    <span key={i} className={`text-2xl ${i < hearts ? 'text-red-500' : 'text-duolingo-gray-300'}`}>‚ù§Ô∏è</span>
                                ))}
                            </div>
                        </div>

                        <ProgressBar 
                            current={currentSentenceIndex + 1} 
                            total={lesson.sentences.length} 
                            className="mb-8"
                        />

                        <div className="text-center mb-8">
                            <h2 className="text-3xl font-bold text-duolingo-gray-800 mb-4">
                                Trouvez l'erreur d'orthographe
                            </h2>
                            <p className="text-lg text-duolingo-gray-600">
                                Cliquez sur le mot mal orthographi√©
                            </p>
                        </div>

                        <div className="text-center mb-8">
                            <div className="text-2xl leading-relaxed mb-6 p-8 bg-duolingo-gray-100 rounded-xl">
                                {currentSentence.words.map((word, index) => (
                                    <span
                                        key={index}
                                        className={getWordClassName(index)}
                                        onClick={() => handleWordClick(index)}
                                    >
                                        {word}
                                    </span>
                                ))}
                            </div>
                            
                            <p className="text-duolingo-gray-600 italic text-lg mb-6">
                                "{currentSentence.translation}"
                            </p>
                            
                            <button
                                onClick={handleNoMistake}
                                className="bg-duolingo-blue text-white px-6 py-3 rounded-xl font-bold hover:bg-duolingo-blue-dark transition-all duration-200"
                                disabled={showFeedback}
                            >
                                Aucune erreur
                            </button>
                        </div>

                        {showFeedback && (
                            <div className="text-center fade-in">
                                {selectedWord?.correct || (showFeedback && !selectedWord) ? (
                                    <div className="bg-duolingo-green/10 border border-duolingo-green rounded-xl p-6">
                                        <div className="text-duolingo-green text-2xl font-bold mb-2">
                                            ‚úÖ Excellent !
                                        </div>
                                        {currentSentence.explanation && (
                                            <p className="text-duolingo-gray-700">
                                                {currentSentence.explanation}
                                            </p>
                                        )}
                                    </div>
                                ) : (
                                    <div className="bg-duolingo-red/10 border border-duolingo-red rounded-xl p-6">
                                        <div className="text-duolingo-red text-2xl font-bold mb-2">
                                            ‚ùå Pas tout √† fait...
                                        </div>
                                        <p className="text-duolingo-gray-700">
                                            La bonne r√©ponse √©tait: <strong>{currentSentence.correction}</strong>
                                        </p>
                                        <p className="text-duolingo-gray-600 mt-2">
                                            {currentSentence.explanation}
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [currentView, setCurrentView] = useState('home');
            const [selectedLesson, setSelectedLesson] = useState(null);
            const [userXp, setUserXp] = useLocalStorage('cacography_xp', 0);
            const [userHearts, setUserHearts] = useLocalStorage('cacography_hearts', 5);
            const [userStreak, setUserStreak] = useLocalStorage('cacography_streak', 0);
            const [completedLessons, setCompletedLessons] = useLocalStorage('cacography_completed', []);

            const startLesson = (lesson) => {
                setSelectedLesson(lesson);
                setCurrentView('game');
            };

            const completeLesson = (score, remainingHearts) => {
                const earnedXp = selectedLesson.xp + (score * 10);
                setUserXp(userXp + earnedXp);
                setUserHearts(Math.max(remainingHearts, 0));
                setUserStreak(userStreak + 1);
                
                if (!completedLessons.includes(selectedLesson.id)) {
                    setCompletedLessons([...completedLessons, selectedLesson.id]);
                }
                
                setCurrentView('home');
            };

            const backToHome = () => {
                setCurrentView('home');
                setSelectedLesson(null);
            };

            return (
                <div className="min-h-screen bg-duolingo-gray-100">
                    <Header xp={userXp} hearts={userHearts} streak={userStreak} />
                    
                    {currentView === 'home' && (
                        <div className="max-w-6xl mx-auto px-4 py-8 fade-in">
                            <div className="text-center mb-12">
                                <h2 className="text-5xl font-bold text-duolingo-gray-800 mb-6">
                                    Apprenez l'orthographe fran√ßaise
                                </h2>
                                <p className="text-xl text-duolingo-gray-600 max-w-2xl mx-auto">
                                    Am√©liorez vos comp√©tences en orthographe fran√ßaise avec des exercices interactifs et amusants
                                </p>
                            </div>

                            {/* Easy Lessons */}
                            <div className="mb-12">
                                <h3 className="text-3xl font-bold text-duolingo-green mb-8 flex items-center">
                                    <span className="mr-4">üå±</span>
                                    Niveau Facile
                                </h3>
                                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {lessonData.easy.map(lesson => (
                                        <LessonCard
                                            key={lesson.id}
                                            lesson={lesson}
                                            onStart={startLesson}
                                            isLocked={false}
                                            isCompleted={completedLessons.includes(lesson.id)}
                                        />
                                    ))}
                                </div>
                            </div>

                            {/* Medium Lessons */}
                            <div className="mb-12">
                                <h3 className="text-3xl font-bold text-duolingo-blue mb-8 flex items-center">
                                    <span className="mr-4">üåü</span>
                                    Niveau Moyen
                                </h3>
                                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {lessonData.medium.map(lesson => (
                                        <LessonCard
                                            key={lesson.id}
                                            lesson={lesson}
                                            onStart={startLesson}
                                            isLocked={completedLessons.length < 2}
                                            isCompleted={completedLessons.includes(lesson.id)}
                                        />
                                    ))}
                                </div>
                            </div>

                            {/* Hard Lessons */}
                            <div className="mb-12">
                                <h3 className="text-3xl font-bold text-duolingo-purple mb-8 flex items-center">
                                    <span className="mr-4">üèÜ</span>
                                    Niveau Difficile
                                </h3>
                                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {lessonData.hard.map(lesson => (
                                        <LessonCard
                                            key={lesson.id}
                                            lesson={lesson}
                                            onStart={startLesson}
                                            isLocked={completedLessons.length < 3}
                                            isCompleted={completedLessons.includes(lesson.id)}
                                        />
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {currentView === 'game' && selectedLesson && (
                        <GameScreen
                            lesson={selectedLesson}
                            onComplete={completeLesson}
                            onBack={backToHome}
                        />
                    )}
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>